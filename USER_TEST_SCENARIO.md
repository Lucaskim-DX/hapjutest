# 🎯 사용자 테스트 시나리오 – `webrtc‑mesh‑test`

> **목표**: 일반 사용자가 실제 환경에서 각 기능을 체험하고, 기대 동작을 확인한다.
> **전제 조건**
> - 최신 Chrome/Edge 브라우저 (HTTPS 또는 `http://localhost:3000`)
> - 마이크와 화면/시스템 오디오 공유 권한을 허용한 상태
> - 최소 2대의 디바이스(PC, 노트북, 모바일) 혹은 2개의 브라우저 탭
> - 프로젝트가 `npm run dev` 로 실행 중이어야 함

---

## 1️⃣ 시작하기 (방 만들기 & 입장)

1. **첫 번째 디바이스**에서 `http://localhost:3000` 접속
2. 닉네임을 `Alice` 로 입력하고, 방 ID를 `testroom` 으로 지정 후 **Join** 클릭
3. **두 번째 디바이스**(또는 새 탭)에서도 같은 URL 접속
4. 닉네임을 `Bob` 으로 입력하고, 동일 방 ID `testroom` 입력 후 **Join** 클릭
5. **예상 결과**
   - 두 화면에 각각 **피어 카드**가 생성되고, `Connecting… → Connected` 로 변함
   - 화면 좌측 상단에 `Alice` 와 `Bob` 의 이름이 표시됨
   - `Leave` 버튼이 비활성화되고, `Join` 버튼이 활성화됨

---

## 2️⃣ 마이크 오디오 테스트

1. 양쪽 모두 **마이크 아이콘**(🔊)이 켜진 상태인지 확인
2. `Alice` 가 **마이크 볼륨 슬라이더**를 70% 로 이동
3. `Bob` 은 **볼륨 바**(`vol-Alice`)가 70% 로 움직이는지 확인
4. `Bob` 이 **Mute** 버튼을 클릭 → `Bob` 의 오디오가 사라지고, `Alice` 쪽 볼륨 바가 0% 로 표시됨
5. `Bob` 이 **Unmute** 다시 클릭 → 오디오 복구 확인
6. **예상 결과**: 실시간 볼륨 바가 정확히 반영되고, 음소거/복구가 즉시 적용된다.

---

## 3️⃣ 시스템 오디오 공유 테스트

1. `Alice` 가 **System Audio** 버튼을 클릭 → “탭 공유 + 오디오” 선택 (예: YouTube 탭)
2. 권한 허용 후 **시스템 오디오 캡처 시작** 알림이 뜨면 확인
3. `Bob` 은 `Alice` 의 오디오가 들리는지 확인 (배경 음악 등)
4. `Alice` 가 **볼륨 슬라이더**를 30% 로 낮추면 `Bob` 의 **시스템 볼륨 바**(`systemVolBar`)가 30% 로 변함
5. `Alice` 가 **Stop System Audio** 버튼을 클릭 → `Bob` 에서 오디오가 사라짐
6. **예상 결과**: 시스템 오디오와 마이크 오디오가 동시에 전송되고, 각각 독립적으로 볼륨 조절 가능.

---

## 4️⃣ 화면 공유 테스트

1. `Bob` 이 **Screen Share** 버튼을 클릭 → 화면(또는 창) 선택 (예: 메모장)
2. 화면 공유가 시작되면 `Bob` 의 피어 카드에 **원격 비디오**가 표시되고, `Alice` 가 실시간으로 화면을 볼 수 있다.
3. `Bob` 이 **Stop** 버튼을 클릭 → 화면이 사라지고, `Alice` 에서 비디오가 사라짐
4. **동시 테스트**: `Bob` 이 화면 공유 중에 `Alice` 가 **System Audio** 를 시작하면 **오류**가 표시되고, `Bob` 은 화면 공유를 먼저 중지하도록 안내받는다.
5. **예상 결과**: 화면 공유가 정상 동작하고, 시스템 오디오와는 충돌 없이 동작한다 (오디오 우선 정책 적용).

---

## 5️⃣ 성능 모니터 & 통계 확인

1. 화면 좌측 하단에 **Performance Monitor** 영역이 보이는지 확인
2. `Uptime`, `Peers`, `Avg Latency`, `Peak Latency`, `Min Latency` 값이 1초마다 업데이트되는지 관찰
3. `Alice` 와 `Bob` 의 피어 카드에 **lat | jitter | loss** 형태의 통계가 표시되는지 확인 (예: `32ms | 2.5ms jitter | 0% loss`)
4. 네트워크가 느릴 때도 **오디오 지연**이 크게 증가하지 않는지 확인 (오디오 우선 최적화 덕분에 지연 최소화)
5. **예상 결과**: 실시간 성능 지표가 정상적으로 표시되고, `[object Object]` 같은 이상 문자열이 나타나지 않는다.

---

## 6️⃣ 채팅 기능 테스트

1. `Alice` 가 채팅 입력창에 `Hello Bob!` 입력 후 **Enter**
2. `Bob` 이 메시지를 실시간으로 확인하고, 자신의 입력창에 `Hi Alice!` 입력 후 전송
3. **시스템 메시지**(예: `Bob joined the room`) 가 *italic* 로 표시되는지 확인
4. 새 메시지가 도착할 때마다 채팅창이 자동 스크롤되어 최신 메시지가 보이는지 확인
5. **예상 결과**: 양방향 채팅이 즉시 전달되고, 시스템 메시지가 구분되어 표시된다.

---

## 7️⃣ 메트로놈 (Metronome) 테스트

1. `Alice` 가 **Metronome** 버튼을 클릭하고 BPM을 `120` 으로 설정 후 **Start**
2. `Bob` 은 메트로놈 비프음이 들리는지 확인 (양쪽 모두 들림)
3. `Alice` 가 **Stop** 버튼을 클릭 → 비프음이 즉시 멈추는지 확인
4. **예상 결과**: 메트로놈이 정확한 BPM 으로 재생되고, 멈출 때 지연이 없다.

---

## 8️⃣ 녹음 (Recording) 테스트

1. `Bob` 이 **Record** 버튼을 클릭 → 녹음 시작
2. `Alice` 가 마이크와 시스템 오디오를 동시에 재생 (예: 음악 재생 + 대화)
3. 5초 후 `Bob` 이 **Stop** 버튼을 클릭 → 다운로드 링크가 생성되는지 확인
4. 다운로드된 `webm` 파일을 재생하여 **마이크와 시스템 오디오**가 모두 포함되어 있는지 확인
5. **예상 결과**: 녹음 파일에 두 오디오가 모두 들어있으며, 정상 재생된다.

---

## 9️⃣ 보안/HTTPS 체크 (일반 사용자 시나리오)

1. **로컬** (`http://localhost:3000`) 에서는 별도 경고 없이 바로 사용 가능
2. **IP 주소** (`http://192.168.x.x:3000`) 로 접속하면 **HTTPS 필요** 경고 화면이 전체에 표시되고, 기능이 차단됨
3. **HTTPS 배포** (예: Render, Vercel) 로 접속하면 정상 동작
4. **예상 결과**: 보안이 필요한 경우 경고가 명확히 표시되고, HTTPS 환경에서는 문제 없이 동작한다.

---

## ✅ 테스트 완료 체크리스트 (사용자 입장)

- [ ] 모든 권한(마이크, 화면/시스템 오디오) 허용
- [ ] 두 디바이스(또는 탭)에서 방에 입장 → 피어 연결 확인
- [ ] 마이크, 시스템 오디오, 화면 공유 각각 독립·동시·중지 흐름 검증
- [ ] 볼륨 슬라이더와 프리셋 적용 확인
- [ ] 성능 모니터와 통계 UI가 정상 업데이트
- [ ] 채팅/시스템 메시지 정상 표시
- [ ] 메트로놈과 녹음 기능이 오디오와 충돌 없이 동작
- [ ] 보안 경고가 필요 없는 환경(HTTPS/localhost)에서 정상 동작

---

### 🎉 최종 기대 결과
- **오디오**(마이크+시스템) 가 **지연 없이** 전송되고, **볼륨** 조절이 실시간 반영됨
- **화면 공유**가 새 피어에게 즉시 전송되고, **오디오 우선** 정책으로 합주 품질이 유지됨
- **성능 모니터**와 **통계**가 정확히 표시되며 UI에 `[object Object]` 같은 이상 문자열이 나타나지 않음
- **보안 경고**가 필요 없는 환경(HTTPS/localhost)에서 정상 동작

---

**즐거운 테스트 되세요!** 🎵
