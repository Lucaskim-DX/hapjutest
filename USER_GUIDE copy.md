# 🎵 WebRTC Mesh Audio - Performance Edition 사용 가이드

## 목차
1. [시작하기](#1-시작하기)
2. [방 만들기 (호스트)](#2-방-만들기-호스트)
3. [방 참여하기](#3-방-참여하기)
4. [오디오 기능](#4-오디오-기능)
5. [메트로놈](#5-메트로놈)
6. [채팅](#6-채팅)
7. [화면 공유](#7-화면-공유)
8. [녹음](#8-녹음)
9. [호스트 기능](#9-호스트-기능)
10. [성능 모니터링](#10-성능-모니터링)
11. [성능 최적화 가이드](#11-성능-최적화-가이드)
12. [문제 해결](#12-문제-해결)

---

## 1. 시작하기

### 서버 실행
```bash
cd webrtc-mesh-test
npm start
```

### 접속
- **로컬**: `http://localhost:3000`
- **같은 네트워크**: `http://[서버IP]:3000`

### 최소 요구사항
| 항목 | 요구사항 |
|------|----------|
| 브라우저 | Chrome 90+, Edge 90+, Firefox 85+ |
| 마이크 | 필수 (권한 허용 필요) |
| 네트워크 | 최소 1Mbps, 권장 5Mbps+ |
| CPU | 듀얼코어 이상 권장 |

---

## 2. 방 만들기 (호스트)

### 기본 방 생성
1. **Room ID** 입력 (예: `my-band-room`)
2. **Nickname** 입력
3. **➕ Create** 버튼 클릭
4. 마이크 권한 허용

### 호스트 설정 (Host Controls)

| 설정 | 설명 | 기본값 |
|------|------|--------|
| **Max Peers** | 최대 참가자 수 | 12명 |
| **Password** | 방 비밀번호 | 없음 |
| **Waiting Room** | 대기실 모드 | OFF |

---

## 3. 방 참여하기

### 일반 참여
1. **Room ID** 입력
2. **Nickname** 입력
3. **Password** 입력 (필요시)
4. **🚀 Join** 클릭

### 대기실 모드
- "Waiting for approval..." 표시
- 호스트 승인 후 자동 입장
- 거부 시 알림 후 연결 종료

---

## 4. 오디오 기능

### 마이크 제어
| 버튼 | 기능 |
|------|------|
| **🎤 Mute** | 음소거 |
| **🔇 Unmute** | 음소거 해제 |

### 마이크 선택
- 드롭다운에서 오디오 장치 선택
- USB 마이크, 오디오 인터페이스 등 지원

### 볼륨 조절
| 구분 | 범위 | 설명 |
|------|------|------|
| **Master** | 0~100% | 전체 수신 볼륨 |
| **개별** | 0~150% | 참가자별 볼륨 (부스트 가능) |

### 볼륨 미터
- 🎤 옆 녹색 바로 실시간 음성 레벨 확인
- 말하는 사람 시각적 식별

---

## 5. 메트로놈

### 제어 (호스트 전용)
| 버튼 | 기능 |
|------|------|
| **▶** | 메트로놈 시작 |
| **■** | 메트로놈 정지 |
| **±5** | BPM 5단위 조절 |

### BPM 범위
- 최소: 40 BPM
- 최대: 240 BPM

### 동기화
- 모든 참가자에게 실시간 동기화
- 4비트 시각 표시: ● ○ ○ ○
- 첫 비트(악센트) = 높은 음

---

## 6. 채팅

### 사용법
1. 메시지 입력
2. **Enter** 또는 **↵** 클릭

### 메시지 유형
- **일반**: 참가자 메시지
- **시스템**: 입장/퇴장/호스트 변경 알림

---

## 7. 화면 공유

### 사용법
1. **🖥️ Share** 클릭
2. 화면/창/탭 선택
3. **🖥️ Stop** 클릭하여 종료

### 용도
- 악보 공유
- 지휘 영상
- 튜토리얼

---

## 8. 녹음

### 시작/종료
1. **⏺️ Rec** 클릭 → 녹음 시작 (빨간 REC 표시)
2. **⏹️ Stop** 클릭 → WebM 파일 다운로드

### 녹음 내용
- 내 마이크 + 모든 참가자 오디오 믹스
- 형식: WebM (Opus 코덱)

---

## 9. 호스트 기능

### 권한
| 기능 | 설명 |
|------|------|
| 메트로놈 제어 | 시작/정지/BPM |
| 대기실 승인 | ✓ 승인 / ✗ 거부 |
| 참가자 음소거 | 강제 Mute |
| 참가자 추방 | Kick |

### 호스트 양도
- 호스트 퇴장 시 자동으로 다음 참가자에게 양도

---

## 10. 성능 모니터링

### 📈 Performance Monitor 패널

#### 실시간 지표
| 지표 | 설명 | 정상 범위 |
|------|------|----------|
| **Uptime** | 세션 지속 시간 | - |
| **Peers** | 연결된 참가자 수 | 1~12 |
| **Avg Latency** | 평균 왕복 지연 | < 100ms |
| **Peak Latency** | 최대 지연 | < 200ms |
| **Min Latency** | 최소 지연 | - |
| **Jitter** | 지연 변동폭 | < 30ms |
| **Packet Loss** | 패킷 손실 누적 | < 10 |
| **Bitrate** | 현재 오디오 비트레이트 | 32~64 kbps |

#### 그래프
- **Latency History**: 최근 60초 지연 추이 (청색)
- **Bitrate History**: 최근 60초 비트레이트 추이 (녹색)

#### 메모리 사용량
- JavaScript 힙 메모리 (Chrome만 지원)

### Low Latency Mode
| 상태 | 동작 |
|------|------|
| **ON** (기본) | 오디오 지연 최소화 (0.01초) |
| **OFF** | 안정성 우선 (0.1초 버퍼) |

토글 클릭으로 전환 (재연결 시 적용)

---

## 11. 성능 최적화 가이드

### 자동 최적화 기능

#### ✅ 적응형 비트레이트 (ABR)
네트워크 상태에 따라 자동 조절:

| 네트워크 상태 | 비트레이트 |
|--------------|-----------|
| 🟢 양호 (Latency < 150ms, Loss < 2%) | 64 kbps |
| 🟡 보통 (Latency < 300ms, Loss < 5%) | 48 kbps |
| 🔴 불량 | 32 kbps |

#### ✅ Opus 코덱 최적화
- **FEC** (Forward Error Correction): 패킷 손실 복구
- **DTX** (Discontinuous Transmission): 무음 시 대역폭 절약
- **Mono**: 단일 채널로 대역폭 절감

#### ✅ ICE 최적화
- 후보 사전 수집 (candidatePoolSize: 10)
- 번들 정책 (max-bundle)
- 자동 ICE Restart

### 수동 최적화 팁

#### 네트워크
| 권장 | 이유 |
|------|------|
| 유선 LAN | 가장 낮은 지연 |
| 5GHz WiFi | 2.4GHz보다 안정적 |
| VPN 비활성화 | 추가 지연 방지 |
| QoS 설정 | 트래픽 우선순위 |

#### 오디오 장비
| 권장 | 이유 |
|------|------|
| 헤드셋/이어폰 | 에코 방지 |
| 외부 마이크 | 내장 마이크보다 품질↑ |
| 오디오 인터페이스 | 저지연 드라이버 |

#### 시스템
| 권장 | 이유 |
|------|------|
| 다른 앱 종료 | CPU/메모리 확보 |
| 브라우저 탭 최소화 | 리소스 절약 |
| 하드웨어 가속 ON | GPU 활용 |

---

## 12. 문제 해결

### 연결 문제

#### "Connection error" 표시
1. 서버 실행 상태 확인
2. 방화벽 설정 확인 (포트 3000)
3. URL 재확인

#### 자주 끊어짐
1. **Low Latency Mode** OFF 시도
2. 유선 연결 사용
3. 참가자 수 줄이기

#### ICE 연결 실패
1. VPN 비활성화
2. 방화벽에서 UDP 허용
3. TURN 서버 사용 확인 (자동)

### 오디오 문제

#### 마이크 인식 안됨
1. 브라우저 권한 확인
2. 시스템 설정 확인
3. 페이지 새로고침

#### 소리 안들림
1. Master 볼륨 확인
2. 개별 참가자 볼륨 확인
3. 시스템 볼륨 확인

#### 에코 발생
1. 헤드폰/이어폰 사용
2. 스피커-마이크 거리 확보

#### 음질 저하
1. **Performance Monitor**에서 Latency/Loss 확인
2. 네트워크 상태 개선
3. 참가자 수 줄이기

### 성능 문제

#### 높은 지연 (> 200ms)
1. 유선 네트워크 사용
2. 다른 대역폭 앱 종료
3. 참가자 수 줄이기 (8명 이하 권장)

#### 패킷 손실 증가
1. WiFi → 유선 전환
2. 라우터 재시작
3. 비트레이트 자동 조절 확인

#### 메모리 사용량 증가
1. 장시간 세션 시 페이지 새로고침
2. 다른 브라우저 탭 닫기

---

## 네트워크 통계 해석

### 각 피어 카드 통계
```
Lat: 45ms | Jit: 12ms
↑32kbps ↓48kbps
Loss: 0 | host | Opus
```

| 항목 | 의미 |
|------|------|
| **Lat** | 왕복 지연 시간 |
| **Jit** | 지연 변동폭 |
| **↑/↓** | 송신/수신 비트레이트 |
| **Loss** | 패킷 손실 수 |
| **host/srflx/relay** | 연결 유형 |
| **Opus** | 사용 코덱 |

### 연결 유형
| 유형 | 설명 | 품질 |
|------|------|------|
| **host** | 직접 연결 | 🟢 최상 |
| **srflx** | NAT 통과 | 🟢 양호 |
| **relay** | TURN 경유 | 🟡 지연 발생 |

### 품질 바 (■■■■■)
| 색상 | 상태 | 지연 |
|------|------|------|
| 🟢 녹색 | 우수 | < 50ms |
| 🟡 노란색 | 보통 | 50~150ms |
| 🔴 빨간색 | 불량 | > 150ms |

---

## 권장 사용 환경

### 최적 조건
| 항목 | 권장 |
|------|------|
| 참가자 수 | 8명 이하 |
| 네트워크 | 유선 LAN 또는 5GHz WiFi |
| 오디오 | 헤드셋 사용 |
| 브라우저 | Chrome 최신 버전 |
| Low Latency | ON |

### 합주 팁
1. **메트로놈 활용**: 박자 맞추기
2. **개별 볼륨 조절**: 밸런스 맞추기
3. **헤드폰 필수**: 모니터링 + 에코 방지
4. **녹음 활용**: 결과 확인 및 개선
5. **Performance Monitor 확인**: 품질 모니터링

---

## 단축키

| 키 | 기능 |
|----|------|
| **Enter** (채팅) | 메시지 전송 |

---

## 기술 사양

### 오디오
| 항목 | 값 |
|------|------|
| 코덱 | Opus |
| 샘플레이트 | 48kHz |
| 채널 | Mono |
| 비트레이트 | 32~64 kbps (적응형) |

### WebRTC
| 항목 | 값 |
|------|------|
| ICE 서버 | STUN (Google) + TURN (OpenRelay) |
| 번들 정책 | max-bundle |
| RTCP Mux | 필수 |

---

## 버전 정보

- **버전**: Performance Edition 2.0
- **최종 수정**: 2025-12-23
- **주요 기능**:
  - Mesh P2P 오디오
  - 메트로놈 동기화
  - 채팅
  - 녹음
  - 화면 공유
  - 호스트 관리
  - **성능 모니터링 대시보드**
  - **적응형 비트레이트**
  - **저지연 모드**
  - **Opus 코덱 최적화**

---

*문의사항이나 개선 제안은 언제든 환영합니다!*
